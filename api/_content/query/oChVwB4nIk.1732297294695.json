{"_path":"/blog/weekly_update_22-11","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Weekly Update 22-11","description":"The week began with the cluster almost in a ready state, but issues emerged during testing with MPI and SLURM. Specifically: SLURM (srun) Only ran in singleton mode without errors but failed to scale. MPI (mpirun) Crashed outright, returning an error: \"PSEC: munge failed to create credential: Socket communication error.\"","author":"Alessio Olivieri","gh_nickname":"Alessio-Olivieri","date":"2024-11-22T00:00:00.000Z","image":"https://res.cloudinary.com/dllutk9zl/image/upload/v1732270953/Plum_at_SC24_eozc8d.jpg","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"cluster-issues-with-mpi-and-slurm"},"children":[{"type":"text","value":"Cluster Issues with MPI and SLURM"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The week began with the cluster almost in a ready state, but issues emerged during testing with MPI and SLURM. Specifically:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"SLURM ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"srun"}]},{"type":"text","value":")"}]},{"type":"text","value":": Only ran in singleton mode without errors but failed to scale."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"MPI ("},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mpirun"}]},{"type":"text","value":")"}]},{"type":"text","value":": Crashed outright, returning an error: \"PSEC: munge failed to create credential: Socket communication error.\""}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The issue was "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Munge"}]},{"type":"text","value":", a tool SLURM uses for authentication across nodes. Although all nodes had it installed and shared the same "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"munge.key"}]},{"type":"text","value":", "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mpirun"}]},{"type":"text","value":" continued to fail."}]},{"type":"element","tag":"h3","props":{"id":"solution-attempts-and-breakthrough"},"children":[{"type":"text","value":"Solution Attempts and Breakthrough"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"After trying several fixes, we found a relevant article by "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Hossein Ghorbanfekr"}]},{"type":"text","value":" on Medium, which detailed a similar setup using Raspberry Pi 4 with a Pi 3 as master: he compiled SLURM, and MPI from scratch and his setup was working, however the same authentication issue persisted."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Later, a deeper research persisted by Ernesto revealed an Intel cluster userâ€™s solution:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"By setting "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"PMIX_MCA_psec0=native"}]},{"type":"text","value":", MPI bypassed Munge and used its default authentication. This change allowed MPI to communicate properly across nodes without the Munge authentication layer."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Testing this:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"PMIX_MCA_psec0=munge"}]}]},{"type":"text","value":" with "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"srun -n 16 hostname"}]},{"type":"text","value":" worked."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mpirun"}]}]},{"type":"text","value":" still faced issues, which we plan to address when we have more time, as the current priority is communication stability."}]}]},{"type":"element","tag":"h2","props":{"id":"hardware-upgrade"},"children":[{"type":"text","value":"Hardware Upgrade"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We decided to include the previous master "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz0"}]},{"type":"text","value":" (The only node with 8GB of RAM) in the computational nodes and passed the role of the master to "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Andrea"}]},{"type":"text","value":", a Raspberry Pi 3b with 1 GB of RAM, enhancing the cluster specs:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"28GB -> 36 GB of RAM"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"28->32 cores"}]}]}]},{"type":"element","tag":"h3","props":{"id":"potential-problems-of-this-approach"},"children":[{"type":"text","value":"Potential Problems of this approach"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz0"}]},{"type":"text","value":" still handles the filesystem... This might be a potential bottleneck when the multiple users try to use the server at the same time since it has more tasks to do."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The problem will be solved when the filesystem will be handled by the master, which will happen when we get more raspberries"}]},{"type":"element","tag":"h5","props":{"id":"saverio-is-now-satisfied-that-his-previously-underutilized-hardware-was-put-to-work"},"children":[{"type":"text","value":"Saverio is now satisfied that his previously underutilized hardware was put to work!"}]},{"type":"element","tag":"h3","props":{"id":"next-steps"},"children":[{"type":"text","value":"Next Steps"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Using munge for the authentication will be scheduled for later, as we prioritize cluster stability for the presentation of the 13/11/24 (which has been rescheduled for the 20/11/24)"}]},{"type":"element","tag":"h2","props":{"id":"plum-juice-cluster-presentation-in-the-multicore-class"},"children":[{"type":"text","value":"Plum juice cluster presentation in the multicore class"}]},{"type":"element","tag":"h3","props":{"id":"make-the-world-know-about-us"},"children":[{"type":"text","value":"Make the world know about us."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Professor De Sensi gave us 15 minutes of it's multicore classto present our cluster to the students. This is a big opportunity to expand the plum juice team and to make the world know about us!"}]},{"type":"element","tag":"h3","props":{"id":"whats-the-multicore-course-about"},"children":[{"type":"text","value":"What's the multicore course about?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The multicore course has been tought to give a deep understanding and practical experience about parallel programming. This is done by proposing the students homeworks where they have to implement classic parallelizable problems like "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"matrix multiplication"}]},{"type":"text","value":", "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"histograms computation"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"integral approximation"}]},{"type":"text","value":". The taught libraries are: "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"MPI, OpenMP, Pthreads"}]},{"type":"text","value":" and "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Cuda"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h3","props":{"id":"what-do-we-offer"},"children":[{"type":"text","value":"What do we offer?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Plum juice team offers to give students the possibility to easily test their applications on a truly multi node system, effectively simulating more expensive clusters like Leonardo."}]},{"type":"element","tag":"h3","props":{"id":"our-expectations"},"children":[{"type":"text","value":"Our expectations."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Every plum has their own expectactions from this presentation:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz:"}]},{"type":"text","value":" We're dumb"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Saverio:"}]},{"type":"text","value":" I expect money"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Lachi:"}]},{"type":"text","value":" ehhh booh... nobody will be interested"}]}]},{"type":"element","tag":"h3","props":{"id":"where-and-when-can-you-find-us"},"children":[{"type":"text","value":"Where and when can you find us:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Aula A1, Via del Castro Laurenziano at 14:00."}]},{"type":"element","tag":"h2","props":{"id":"behind-the-scenes-when-nothing-was-still-working"},"children":[{"type":"text","value":"Behind the scenes, when nothing was still working"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Ok, now Slurm is starting!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Oh no, just kidding... it can't find the node name. Perfect, we're off to a great start."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Guys, the configuration file is full of errors... honestly, it's embarrassing."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Saverio"}]},{"type":"text","value":": Umm... maybe because you're running it from the master? Just a thought."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Why doesn't poor ciz0 have Slurm installed? This is discrimination!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Fine, I just need to add it to the playbook, right?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Wait, so it's not installed at all. Great."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ernesto"}]},{"type":"text","value":": Actually, if there's no Munge, Slurm won't even acknowledge you. It's like an honor code."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Ok, summary: changed the master password, removed TaskAffinity from the config because it was throwing errors anyway. Don't ask me why it's in the docs, but it doesn't work."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Then, added the node name, and now Slurmd is running on all nodes! ðŸŽ‰"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Ciz"}]},{"type":"text","value":": Oh, but Slurmctld won't start because it can't create /var/spool/slurmctld. Of course, it doesn't have permissions... nothing works, help me."}]},{"type":"element","tag":"h5","props":{"id":"the-discussion-reached-the-point-where-we-were-considering-a-full-reset"},"children":[{"type":"text","value":"... The discussion reached the point where we were considering a full reset ..."}]},{"type":"element","tag":"h4","props":{"id":"in-the-meanwhile-saverio-had-news-that-nobody-asked-for"},"children":[{"type":"text","value":"In the meanwhile Saverio had news that nobody asked for"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Saverio"}]},{"type":"text","value":": How cool is the rack?"}]},{"type":"element","tag":"figure","props":{"className":["not-centerd"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/dllutk9zl/image/upload/v1732001405/whatsapp1_sqoiwe.jpg","alt":""},"children":[]}]},{"type":"text","value":"   \n"},{"type":"element","tag":"h4","props":{"id":"in-the-middle-of-desperation-the-only-friendly-answer-to-saverio-was-simones"},"children":[{"type":"text","value":"In the middle of desperation, the only friendly answer to Saverio was Simone's:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Simone"}]},{"type":"text","value":": Current situation: Ciz and Ernesto desperate between Wi-Fi and Slurm."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Simone"}]},{"type":"text","value":": Meanwhile, Saverio in tech support mode:"}]},{"type":"element","tag":"figure","props":{"className":["not-centerd"]},"children":[{"type":"text","value":"\n   "},{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/dllutk9zl/image/upload/v1732001407/geppetto_muhtxu.jpg","alt":""},"children":[]}]},{"type":"text","value":"  \n"},{"type":"element","tag":"text","props":{"className":["centered"]},"children":[{"type":"element","tag":"h4","props":{"id":"saverio-officially-crowned-mvp-of-confusion"},"children":[{"type":"text","value":"Saverio, officially crowned MVP of confusion."}]}]}]},{"type":"element","tag":"h2","props":{"id":"a-plum-at-the-sc24"},"children":[{"type":"text","value":"A Plum at the SC24"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This week Lorenzo attended "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"SC24"}]},{"type":"text","value":", the world's biggest HPC conference! (what a lucky plum he is...)\nIt has been a tremendous experience and... "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"OH WAIT"}]},{"type":"text","value":", cannot disclose it now, he will write about it!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"So, if you want to know what SC24 was about, stay tuned guys"}]},{"type":"element","tag":"figure","props":{},"children":[{"type":"text","value":"\n    "},{"type":"element","tag":"img","props":{"src":"https://res.cloudinary.com/dllutk9zl/image/upload/v1732270953/Plum_at_SC24_eozc8d.jpg","alt":""},"children":[]},{"type":"text","value":"\n    "},{"type":"element","tag":"figcaption","props":{},"children":[{"type":"text","value":"Lorenzo at the International Conference for High Performance Computing, Networking, Storage, and Analysis"}]}]},{"type":"element","tag":"credits","props":{":authors":"[{\"name\": \"Alessio Olivieri\", \"github_nickname\": \"Alessio-Olivieri\"}]"},"children":[]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"cluster-issues-with-mpi-and-slurm","depth":2,"text":"Cluster Issues with MPI and SLURM","children":[{"id":"solution-attempts-and-breakthrough","depth":3,"text":"Solution Attempts and Breakthrough"}]},{"id":"hardware-upgrade","depth":2,"text":"Hardware Upgrade","children":[{"id":"potential-problems-of-this-approach","depth":3,"text":"Potential Problems of this approach"},{"id":"next-steps","depth":3,"text":"Next Steps"}]},{"id":"plum-juice-cluster-presentation-in-the-multicore-class","depth":2,"text":"Plum juice cluster presentation in the multicore class","children":[{"id":"make-the-world-know-about-us","depth":3,"text":"Make the world know about us."},{"id":"whats-the-multicore-course-about","depth":3,"text":"What's the multicore course about?"},{"id":"what-do-we-offer","depth":3,"text":"What do we offer?"},{"id":"our-expectations","depth":3,"text":"Our expectations."},{"id":"where-and-when-can-you-find-us","depth":3,"text":"Where and when can you find us:"}]},{"id":"behind-the-scenes-when-nothing-was-still-working","depth":2,"text":"Behind the scenes, when nothing was still working"},{"id":"a-plum-at-the-sc24","depth":2,"text":"A Plum at the SC24"}]}},"_type":"markdown","_id":"content:blog:weekly_update_22-11.md","_source":"content","_file":"blog/weekly_update_22-11.md","_stem":"blog/weekly_update_22-11","_extension":"md"}